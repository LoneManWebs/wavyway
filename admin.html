<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Wavy Way</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .sidebar { background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%); min-height: 100vh; }
        .nav-item.active { background-color: rgba(255, 255, 255, 0.1); border-left: 4px solid #60a5fa; }
        .stat-card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); }
        .btn-primary { background-color: #3b82f6; color: white; padding: 10px 20px; border-radius: 8px; font-weight: 600; }
        .btn-danger { background-color: #ef4444; color: white; padding: 8px 16px; border-radius: 6px; font-weight: 500; }
        .modal-overlay { background-color: rgba(0, 0, 0, 0.5); position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background-color: white; border-radius: 12px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gray-50 p-4">
        <div class="max-w-md w-full space-y-8 bg-white p-8 rounded-2xl shadow-lg">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900">Admin Login</h2>
                <p class="text-gray-600 mt-2">Wavy Way Restaurant Admin Panel</p>
            </div>
            
            <form id="loginForm" class="mt-8 space-y-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="username" required class="w-full p-3 border rounded-lg" placeholder="admin">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="password" required class="w-full p-3 border rounded-lg" placeholder="admin123">
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-red-600 text-white p-3 rounded-lg font-bold hover:bg-red-700">
                    Sign In
                </button>
                
                <div class="text-center text-sm text-gray-500">
                    <p>Default: admin / admin123</p>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <div class="flex">
            <!-- Sidebar -->
            <div class="sidebar w-64 text-white">
                <div class="p-6">
                    <div class="flex items-center space-x-3 mb-8">
                        <span class="text-xl font-bold">Wavy Way Admin</span>
                    </div>
                    
                    <nav class="space-y-2">
                        <a href="#" data-section="dashboard" class="nav-item flex items-center space-x-3 p-3 rounded-lg transition">
                            <i class="fas fa-tachometer-alt w-6"></i>
                            <span>Dashboard</span>
                        </a>
                        <a href="#" data-section="menu" class="nav-item flex items-center space-x-3 p-3 rounded-lg transition">
                            <i class="fas fa-utensils w-6"></i>
                            <span>Menu Items</span>
                        </a>
                        <a href="#" data-section="testimonials" class="nav-item flex items-center space-x-3 p-3 rounded-lg transition">
                            <i class="fas fa-star w-6"></i>
                            <span>Testimonials</span>
                        </a>
                        <a href="/" class="nav-item flex items-center space-x-3 p-3 rounded-lg transition">
                            <i class="fas fa-external-link-alt w-6"></i>
                            <span>View Website</span>
                        </a>
                        <button id="logoutBtn" class="w-full text-left nav-item flex items-center space-x-3 p-3 rounded-lg transition text-red-300 hover:text-red-100">
                            <i class="fas fa-sign-out-alt w-6"></i>
                            <span>Logout</span>
                        </button>
                    </nav>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="flex-1 p-6">
                <!-- Menu Items Section -->
                <div id="menuSection" class="hidden">
                    <div class="flex justify-between items-center mb-8">
                        <h1 class="text-3xl font-bold text-gray-900">Menu Items Management</h1>
                        <button onclick="showAddItemModal()" class="btn-primary">
                            <i class="fas fa-plus mr-2"></i> Add New Item
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">ID</th>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">Name</th>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">Category</th>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">Price</th>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="menuTableBody">
                                <!-- Menu items will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Testimonials Section -->
                <div id="testimonialsSection" class="hidden">
                    <div class="flex justify-between items-center mb-8">
                        <h1 class="text-3xl font-bold text-gray-900">Testimonials Management</h1>
                        <button onclick="showAddTestimonialModal()" class="btn-primary">
                            <i class="fas fa-plus mr-2"></i> Add Testimonial
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">ID</th>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">Customer</th>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">Comment</th>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">Rating</th>
                                    <th class="py-3 px-6 text-left text-sm font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="testimonialsTableBody">
                                <!-- Testimonials will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Menu Item Modal -->
    <div id="itemModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold" id="modalTitle">Add Menu Item</h2>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="itemForm">
                    <input type="hidden" id="itemId">
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Item Name</label>
                            <input type="text" id="itemName" required class="w-full p-3 border rounded-lg" placeholder="Enter item name">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="itemDescription" rows="3" class="w-full p-3 border rounded-lg" placeholder="Enter item description"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Price ($)</label>
                                <input type="number" id="itemPrice" required step="0.01" min="0" class="w-full p-3 border rounded-lg" placeholder="0.00">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                                <select id="itemCategory" required class="w-full p-3 border rounded-lg">
                                    <option value="">Select Category</option>
                                    <option value="breakfast">Breakfast</option>
                                    <option value="lunch">Lunch</option>
                                    <option value="dinner">Dinner</option>
                                    <option value="drinks">Drinks</option>
                                    <option value="desserts">Desserts</option>
                                    <option value="snacks">Snacks</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-4 mt-8">
                        <button type="button" onclick="closeModal()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="btn-primary px-6 py-2">
                            Save Item
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Add Testimonial Modal -->
    <div id="testimonialModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Add Testimonial</h2>
                    <button onclick="closeTestimonialModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="testimonialForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Customer Name</label>
                            <input type="text" id="customerName" required class="w-full p-3 border rounded-lg" placeholder="Enter customer name">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Rating</label>
                            <select id="rating" class="w-full p-3 border rounded-lg">
                                <option value="5">5 Stars</option>
                                <option value="4">4 Stars</option>
                                <option value="3">3 Stars</option>
                                <option value="2">2 Stars</option>
                                <option value="1">1 Star</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Comment</label>
                            <textarea id="comment" required rows="4" class="w-full p-3 border rounded-lg" placeholder="Enter customer review"></textarea>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-4 mt-8">
                        <button type="button" onclick="closeTestimonialModal()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="btn-primary px-6 py-2">
                            Add Testimonial
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : 'https://api.auraelixir-lb.xyz';
        
        let currentUser = null;
        let editingItemId = null;
        let editingTestimonialId = null;

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const credentials = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentials)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    localStorage.setItem('adminToken', data.token);
                    showAdminDashboard();
                    loadMenuItems();
                    loadTestimonials();
                } else {
                    alert('Invalid credentials. Please try again.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('adminToken');
            currentUser = null;
            showLoginScreen();
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if (this.dataset.section) {
                    e.preventDefault();
                    
                    // Remove active class from all nav items
                    document.querySelectorAll('.nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Hide all sections
                    document.querySelectorAll('[id$="Section"]').forEach(section => {
                        section.classList.add('hidden');
                    });
                    
                    // Show selected section
                    const sectionId = this.dataset.section + 'Section';
                    document.getElementById(sectionId).classList.remove('hidden');
                    
                    // Load data for section
                    if (sectionId === 'menuSection') {
                        loadMenuItems();
                    } else if (sectionId === 'testimonialsSection') {
                        loadTestimonials();
                    }
                }
            });
        });

        // Show/Hide screens
        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
        }

        function showAdminDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            
            // Set menu section as active by default
            document.querySelector('[data-section="menu"]').click();
        }

        // Modal functions
        function showAddItemModal() {
            document.getElementById('modalTitle').textContent = 'Add Menu Item';
            document.getElementById('itemId').value = '';
            document.getElementById('itemName').value = '';
            document.getElementById('itemDescription').value = '';
            document.getElementById('itemPrice').value = '';
            document.getElementById('itemCategory').value = '';
            
            editingItemId = null;
            document.getElementById('itemModal').classList.remove('hidden');
        }

        function showEditItemModal(item) {
            document.getElementById('modalTitle').textContent = 'Edit Menu Item';
            document.getElementById('itemId').value = item.id;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemDescription').value = item.description || '';
            document.getElementById('itemPrice').value = item.price;
            document.getElementById('itemCategory').value = item.category;
            
            editingItemId = item.id;
            document.getElementById('itemModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('itemModal').classList.add('hidden');
        }

        function showAddTestimonialModal() {
            document.getElementById('customerName').value = '';
            document.getElementById('rating').value = '5';
            document.getElementById('comment').value = '';
            editingTestimonialId = null;
            document.getElementById('testimonialModal').classList.remove('hidden');
        }

        function closeTestimonialModal() {
            document.getElementById('testimonialModal').classList.add('hidden');
        }

        // Load menu items
        async function loadMenuItems() {
            try {
                const response = await fetch(`${API_BASE}/api/menu`);
                const items = await response.json();
                const tableBody = document.getElementById('menuTableBody');
                
                tableBody.innerHTML = items.map(item => `
                    <tr class="border-t">
                        <td class="py-4 px-6">${item.id}</td>
                        <td class="py-4 px-6">
                            <div class="font-semibold">${item.name}</div>
                            <div class="text-sm text-gray-500">${item.description || 'No description'}</div>
                        </td>
                        <td class="py-4 px-6">
                            <span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm">
                                ${item.category}
                            </span>
                        </td>
                        <td class="py-4 px-6 font-semibold">$${item.price.toFixed(2)}</td>
                        <td class="py-4 px-6">
                            <div class="flex space-x-2">
                                <button onclick="showEditItemModal(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                    Edit
                                </button>
                                <button onclick="deleteMenuItem(${item.id})" 
                                        class="px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200">
                                    Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading menu items:', error);
                alert('Failed to load menu items');
            }
        }

        // Load testimonials
        async function loadTestimonials() {
            try {
                const response = await fetch(`${API_BASE}/api/testimonials`);
                const testimonials = await response.json();
                const tableBody = document.getElementById('testimonialsTableBody');
                
                tableBody.innerHTML = testimonials.map(testimonial => `
                    <tr class="border-t">
                        <td class="py-4 px-6">${testimonial.id}</td>
                        <td class="py-4 px-6 font-semibold">${testimonial.customer_name}</td>
                        <td class="py-4 px-6 text-gray-600">${testimonial.comment}</td>
                        <td class="py-4 px-6">
                            <div class="text-yellow-500">
                                ${'★'.repeat(testimonial.rating)}${'☆'.repeat(5 - testimonial.rating)}
                            </div>
                        </td>
                        <td class="py-4 px-6">
                            <button onclick="deleteTestimonial(${testimonial.id})" 
                                    class="px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200">
                                Delete
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading testimonials:', error);
                alert('Failed to load testimonials');
            }
        }

        // Save menu item
        document.getElementById('itemForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const itemData = {
                name: document.getElementById('itemName').value,
                description: document.getElementById('itemDescription').value,
                price: document.getElementById('itemPrice').value,
                category: document.getElementById('itemCategory').value
            };
            
            const itemId = document.getElementById('itemId').value;
            const url = itemId ? `${API_BASE}/api/menu/${itemId}` : `${API_BASE}/api/menu`;
            const method = itemId ? 'PUT' : 'POST';
            
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(itemData)
                });
                
                if (response.ok) {
                    alert(itemId ? 'Item updated successfully!' : 'Item added successfully!');
                    closeModal();
                    loadMenuItems();
                } else {
                    alert('Error saving item. Please try again.');
                }
            } catch (error) {
                console.error('Error saving item:', error);
                alert('Error saving item. Please try again.');
            }
        });

        // Add testimonial
        document.getElementById('testimonialForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const testimonialData = {
                customer_name: document.getElementById('customerName').value,
                comment: document.getElementById('comment').value,
                rating: parseInt(document.getElementById('rating').value)
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/testimonials`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testimonialData)
                });
                
                if (response.ok) {
                    alert('Testimonial added successfully!');
                    closeTestimonialModal();
                    loadTestimonials();
                } else {
                    alert('Error adding testimonial. Please try again.');
                }
            } catch (error) {
                console.error('Error adding testimonial:', error);
                alert('Error adding testimonial. Please try again.');
            }
        });

        // Delete menu item
        async function deleteMenuItem(id) {
            if (!confirm('Are you sure you want to delete this menu item?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/menu/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Menu item deleted successfully!');
                    loadMenuItems();
                } else {
                    alert('Error deleting item. Please try again.');
                }
            } catch (error) {
                console.error('Error deleting item:', error);
                alert('Error deleting item. Please try again.');
            }
        }

        // Delete testimonial
        async function deleteTestimonial(id) {
            if (!confirm('Are you sure you want to delete this testimonial?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/testimonials/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Testimonial deleted successfully!');
                    loadTestimonials();
                } else {
                    alert('Error deleting testimonial. Please try again.');
                }
            } catch (error) {
                console.error('Error deleting testimonial:', error);
                alert('Error deleting testimonial. Please try again.');
            }
        }

        // Check if user is already logged in
        window.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('adminToken');
            if (token) {
                // For demo purposes, auto-login
                currentUser = { username: 'admin' };
                showAdminDashboard();
                loadMenuItems();
                loadTestimonials();
            }
        });
    </script>
</body>
</html>
